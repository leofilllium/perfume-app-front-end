function n(){this.eventPushInterval=1e3*this.getRandomInterval(7,11),this.pageLoadedAt=new Date().getTime(),this.eventPool=[],this.lastEventTimestamp=0,this.evtEndpoint="https://analytics.makeup.global/evt",this.ud=!1,this.udType="",this.pvid=this.uuid(),this.buuid=this.bid(),this.userIdentifier="",this.NEXT_PAGE_PAYLOAD="makeupAnalyticsPayload",this.ignoreEventSendDelay=this.getIgnoreDelay();const e=this.getValue(this.NEXT_PAGE_PAYLOAD);if(this.removeItem(this.NEXT_PAGE_PAYLOAD),e){const t=JSON.parse(e);t.hasOwnProperty("evt")&&t.evt.length&&this._send(t)}}n.prototype.getIgnoreDelay=function(){return document.currentScript?new URL(document.currentScript.src).searchParams.get("ignoreDelay")==="true":!1};n.prototype.bid=function(){let e=this.getValue("u");return e||(e=this.uuid(),this.setValue("u",e)),e};n.prototype.getValue=function(e){return window.localStorage?localStorage.getItem(e):null};n.prototype.setValue=function(e,t){if(!window.localStorage)return null;localStorage.setItem(e,t)};n.prototype.removeItem=function(e){if(!window.localStorage)return null;localStorage.removeItem(e)};n.prototype.uuid=function(){let e=new Date().getTime(),t=typeof performance<"u"&&performance.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){let o=Math.random()*16;return e>0?(o=(e+o)%16|0,e=Math.floor(e/16)):(o=(t+o)%16|0,t=Math.floor(t/16)),(r==="x"?o:o&3|8).toString(16)})};n.prototype.getRandomInterval=function(e,t){return Math.random()*(t-e+1)+e};n.prototype.setUDType=function(e){this.udType=e};n.prototype.buildPayload=function(){const e=[];for(;this.eventPool.length;){const r=this.eventPool.pop();r.ud_type=this.udType,e.push(r)}const t={evt:e,bid:this.buuid,ts:Math.round(window.performance.now())};return this.getValue("debug")&&(t.d=this.getValue("debug")),t};n.prototype.getUserPseudoId=function(){return this.buuid};n.prototype.getSid=function(){return this.getValue("sid")||null};n.prototype.parseResponse=function(e){e.hasOwnProperty("sid")?this.setValue("sid",e.sid):this.removeItem("sid")};n.prototype._send=function(e){const t=new XMLHttpRequest;t.open("POST",this.evtEndpoint,!0),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.withCredentials=!0,t.responseType="json",t.onload=()=>{this.parseResponse(t.response)},t.send(JSON.stringify(e))};n.prototype.send=function(e){if(!(!e&&!this.ud)&&this.eventPool.length){const t=this.buildPayload();this._send(t)}};n.prototype.init=function(){setInterval(()=>{this.send()},this.eventPushInterval)};n.prototype.getUrlParam=function(e){return new URL(document.location.href).searchParams.get(e)};n.prototype.eventScaffold=function(){let t=new Date().getTime();return t<=this.lastEventTimestamp&&(t=this.lastEventTimestamp+2),this.lastEventTimestamp=t,{event_timestamp:t,ts:Math.round(window.performance.now()),event_name:"",event_params:{},client_id:this.userIdentifier,site_language:document.documentElement.lang,page_loaded_at:this.pageLoadedAt,page_location:document.location.href,page_title:document.title,page_referrer:document.referrer,utm_source:this.getUrlParam("utm_source")??"",utm_medium:this.getUrlParam("utm_medium")??"",utm_campaign:this.getUrlParam("utm_campaign")??"",utm_content:this.getUrlParam("utm_content")??"",gclid:this.getUrlParam("gclid")??"",term:"",test_group:"",screen_width:window.innerWidth,screen_height:window.innerHeight,time_zone_offset_seconds:new Date().getTimezoneOffset(),hostname:document.location.hostname,platform:"web",app_info:{version:null,id:null,install_source:null}}};n.prototype.push=function(e,t,r){const o=this.eventScaffold();o.event_name=e,o.event_params=t,r&&(o.page_location=r),t.platform&&(o.platform=t.platform),t.app_info&&(o.app_info=t.app_info),this.eventPool.push(o),["add_to_cart","page_view"].includes(e)&&this.send(),(e==="purchase"||t.hasOwnProperty("forceSend")&&t.forceSend===!0)&&this.send(!0)};n.prototype.saveForNextPage=function(){this.eventPool.length&&this.setValue(this.NEXT_PAGE_PAYLOAD,JSON.stringify(this.buildPayload()))};n.prototype.pageView=function(){this.push("page_view",{}),this.send(!0)};n.prototype.setUserIdentifier=function(e){this.userIdentifier=typeof e>"u"?null:e};const i=new n;i.init();window["webAnalytics"]=i;window.addEventListener("load",function(){if(this.ud=!1,i.ignoreEventSendDelay){this.ud=!0,i.setUDType("load"),i.push("page_view",{forceSend:!0});return}setTimeout(function(){i.push("page_view",{})},5e3)});window.addEventListener("beforeunload",function(){i.saveForNextPage()});["mousedown","keypress","scroll","touchstart"].forEach(function(e){document.addEventListener(e,function(t){i.ud=!0,i.setUDType(t.type)},{once:!0})});
